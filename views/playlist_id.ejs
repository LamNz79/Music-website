<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form action="">
        <% data.forEach(element=>{ %>
            <label for="" id="thisId">
                <%=element._id%>
            </label>
            <label for="">NAME</label>
            <input type="text" name="" id="name" value="<%=element.name%>">
            <label for="">PATH</label>
            <input type="file" name="" id="image" value="<%=element.image%>">
            <input type="button" value="submit" onclick="updateUsingId()">

            <% element.songList.forEach(song=>{ %>
    </form>

    <form action="">
        <label for="" id="songID">
            <%=song._id%>
        </label>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
        <label for="">
            <%=song.name%>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
        </label>

        <label for="">
            <button onclick="deleteSongFromListOnClick(`<%=song._id%>`,`deleteSongOnClick`)">delete</button>
        </label>
    </form>
    <%})%>
        <%})%>

            <select name="" id="songList">
                <% songData.forEach(element=>{ %>
                    <option>
                        <%= element.name%>
                    </option>
                    <%})%>
            </select>
            <input type="button" value="add song" id="submitAddSong" onclick="submitAddSongg()">
            <script>
                function updateUsingId() {
                    var thisId = ($('#thisId').text())
                    var name = ($('#name').val())
                    var image = $('#image').val().split('\\').pop();
                    $.post('../updatePlaylistUsingId', {
                        thisId: thisId,
                        name: name,
                        image: image
                    }, (data, status) => {
                        alert(JSON.stringify(data))
                    })
                }

                function submitAddSongg() {
                    var songList = ($('#songList').val())
                    var thisId = ($('#thisId').text()).trim()
                    $.post('../submitPlaylistAddSong', {
                        songList: songList,
                        thisId: thisId
                    }, (data, status) => {
                        alert(JSON.stringify(data))
                        window.location.reload()
                    })
                }
                function deleteSongFromListOnClick(id, path) {
                    var thisID = id.replace(/ /g, "")
                    var thisAlbumId = ($('#thisId').text()).trim()

                    var answer = window.confirm("conform delete?");
                    if (answer) {
                        $.post(`../deleteSongFromPlaylistOnClick`, {
                            thisID: thisID,
                            thisAlbumId: thisAlbumId
                        }, (data, status) => {
                            alert(JSON.stringify(data))
                            window.location.reload()
                        })
                    }
                    else {
                        alert('khong the hoan thanh')
                    }
                }
            </script>
            <script src="/js/function.js"></script>

</body>

</html>